name: Release Docker Image

on:
  push:
    tags:
      - 'v*'

jobs:
  release-docker-image:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Build Docker Image
      run: |
        docker build -t mkkuzi/kasim-runpod-test:${GITHUB_REF_NAME#v} .
        docker save -o kasim-runpod-test-${GITHUB_REF_NAME#v}.tar mkkuzi/kasim-runpod-test:${GITHUB_REF_NAME#v}

    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        files: kasim-runpod-test-${GITHUB_REF_NAME#v}.tar
